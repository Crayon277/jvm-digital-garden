---
{"dg-publish":true,"permalink":"//jvm/java//","dgHomeLink":true,"dgPassFrontmatter":false}
---



>[!info] 
>creation date: 2022-09-01 14:59 
>modification date: Thursday 1st September 2022 14:59:51


>[!example] 过程

### 1. 触发

创建对象通常是`new`关键字，另外可以通过复制和反序列化可以创建

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h5r4xc6c37j208e01nwec.jpg)

### 2. 类加载

遇到一条字节码new，首先去检查这个指令的参数能不能在常量池中定位到一个符号引用，并且检查这个符号引用代表的类是否已被加载，解析和初始化。如果没有那必须先执行类加载的过程

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h5r508461ij20lm03bt8y.jpg)

### 3. 分配内存

类加载检查通过之后，虚拟机将为新生对象分配内存，对象所需内存的大小在类加载完成后便可完全确定。虚拟机为对象分配内存的方式有两种，一种是[[概念要清晰/jvm/java内存区域/指针碰撞|指针碰撞]]，一种是[[概念要清晰/jvm/java内存区域/空闲列表|空闲列表]], 选择那种方式是由java堆内存是否规整决定的，而java堆内存是否规整是由所采用的垃圾收集器是否带有空间压缩整理（compact）的能力决定的，其实就是采用清楚-复制，或者清除-整理算法的，一般是指针碰撞。

#### 3.1 如何解决并发情况修改内存分配指针线程安全问题

对象创建在虚拟机中是非常频繁的行为，那么在并发的情况下，就需要考虑修改指针指向位置时是不是线程安全的。

两种解决方式：

1. 对分配内存的动作进行同步处理。实际上HotSpot虚拟机是采用CAS，并且失败重试的方式
2. [[概念要清晰/jvm/java内存区域/TLAB|TLAB]]

### 4. 内存空间赋值零值

这与类加载的准备阶段做的事情有点类似，一个是为静态变量赋零值，一个是为成员变量赋零值
保证了可以不赋初始值就直接使用。


### 5. 对象头的设置

虚拟机还要对对象进行必要的设置，比如这个对象是哪个类的实例，对象的哈希值，锁的设置，GC分代年龄等。

### 6. 执行\<init\>()方法初始化

这一步才是去执行用户代码，按照程序猿的意愿去对对象进行初始化。


>[!cite] 相关

GC收集器 --> 堆的规整 --> 分配方式

对象的访问方式 --> 对象的内存布局